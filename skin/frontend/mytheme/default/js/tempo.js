/*!
 * Tempo Template Engine 1.8
 *
 * http://tempojs.com/
 */function TempoEvent(e,t,n){"use strict";this.type=e;this.item=t;this.element=n;return this}TempoEvent.Types={RENDER_STARTING:"render_starting",ITEM_RENDER_STARTING:"item_render_starting",ITEM_RENDER_COMPLETE:"item_render_complete",RENDER_COMPLETE:"render_complete"};var Tempo=function(tempo){"use strict";function Templates(e,t){this.params=e;this.defaultTemplate=null;this.namedTemplates={};this.container=null;this.nestedItem=t!==undefined?t:null;this.var_brace_left="\\{\\{";this.var_brace_right="\\}\\}";this.tag_brace_left="\\{%";this.tag_brace_right="%\\}";if(typeof e!="undefined")for(var n in e)if(n==="var_braces"){this.var_brace_left=e[n].substring(0,e[n].length/2);this.var_brace_right=e[n].substring(e[n].length/2)}else if(n==="tag_braces"){this.tag_brace_left=e[n].substring(0,e[n].length/2);this.tag_brace_right=e[n].substring(e[n].length/2)}else typeof this[n]!="undefined"&&(this[n]=e[n]);return this}function Renderer(e){this.templates=e;this.listener=undefined;this.started=!1;this.varRegex=new RegExp(this.templates.var_brace_left+"[ ]?([A-Za-z0-9$\\._\\[\\]]*?)([ ]?\\|[ ]?.*?)?[ ]?"+this.templates.var_brace_right,"g");this.tagRegex=new RegExp(this.templates.tag_brace_left+"[ ]?([\\s\\S]*?)( [\\s\\S]*?)?[ ]?"+this.templates.tag_brace_right+"(([\\s\\S]*?)(?="+this.templates.tag_brace_left+"[ ]?end\\1[ ]?"+this.templates.tag_brace_right+"))?","g");return this}var NUMBER_FORMAT_REGEX=/(\d+)(\d{3})/,utils={memberRegex:function(e){var t="(";for(var n in e)if(e.hasOwnProperty(n)){t.length>1&&(t+="|");t+=n}return t+")"+"(?!\\w)"},pad:function(e,t,n){while(e.length<n)e=t+e;return e},trim:function(e){return e.replace(/^\s*([\S\s]*?)\s*$/,"$1")},startsWith:function(e,t){return e.indexOf(t)===0},clearContainer:function(e){if(e!==null&&e!==undefined&&e.childNodes!==undefined)for(var t=e.childNodes.length;t>=0;t--)e.childNodes[t]!==undefined&&e.childNodes[t].getAttribute!==undefined&&e.childNodes[t].getAttribute("data-template")!==null&&e.childNodes[t].parentNode.removeChild(e.childNodes[t])},isNested:function(e){var t=e.parentNode;while(t){if(t.getAttribute!==undefined&&t.getAttribute("data-template")!==null)return!0;t=t.parentNode}return!1},equalsIgnoreCase:function(e,t){return e.toLowerCase()===t.toLowerCase()},getElement:function(e,t){if(utils.equalsIgnoreCase(e.tagName,"tr")){var n=document.createElement("div");n.innerHTML="<table><tbody>"+t+"</tbody></table>";var r=3;while(r--)n=n.lastChild;return n}e.innerHTML=t;return e},typeOf:function(e){return typeof e=="object"?e===null?"null":e.constructor===[].constructor?"array":e.constructor===(new Date).constructor?"date":e.constructor===(new RegExp).constructor?"regex":"object":typeof e},hasAttr:function(e,t){if(e!==undefined){if(e.hasAttribute!==undefined)return e.hasAttribute(t);if(e.getAttribute!==undefined)return e.getAttribute(t)!==null}return!1},removeAttr:function(e,t){e!==undefined&&e.setAttribute(t,"")},notify:function(e,t){e!==undefined&&e(t)}};Templates.prototype={parse:function(e){this.container=e;var t=e.getElementsByTagName("*");for(var n=0;n<t.length;n++)t[n].getAttribute!==undefined&&(utils.hasAttr(t[n],"data-template")&&this.nestedItem===t[n].getAttribute("data-template")?this.createTemplate(t[n]):utils.hasAttr(t[n],"data-template")&&!utils.isNested(t[n])?this.createTemplate(t[n]):utils.hasAttr(t[n],"data-template-fallback")&&(t[n].style.display="none"));utils.clearContainer(this.container)},createTemplate:function(e){var t=e.cloneNode(!0);t.style.removeAttribute?t.style.removeAttribute("display"):t.style.removeProperty("display");this.container=e.parentNode;var n=!1;for(var r=0;r<t.attributes.length;r++){var i=t.attributes[r];if(utils.startsWith(i.name,"data-if-")){var s;i.value===""?s=!0:s="'"+i.value+"'";this.namedTemplates[i.name.substring(8,i.name.length)+"=="+s]=t;utils.removeAttr(t,i.name);n=!0}}n||(this.defaultTemplate=t)},templateFor:function(i){for(var templateName in this.namedTemplates)if(eval("i."+templateName))return this.namedTemplates[templateName].cloneNode(!0);if(this.defaultTemplate)return this.defaultTemplate.cloneNode(!0)}};Renderer.prototype={notify:function(e){this.listener=e;return this},_replaceVariables:function(renderer,_tempo,i,str){return str.replace(this.varRegex,function(match,variable,args){try{var val=null;if(utils.startsWith(variable,"_tempo."))return eval(variable);variable==="."?val=eval("i"):utils.typeOf(i)==="array"?val=eval("i"+variable):val=eval("i."+variable);var filterSplitter=new RegExp("\\|[ ]?(?="+utils.memberRegex(renderer.filters)+")","g");if(args!==undefined&&args!==""){var filters=utils.trim(utils.trim(args).substring(1)).split(filterSplitter);for(var p=0;p<filters.length;p++){var filter=utils.trim(filters[p]),filter_args=[];if(filter.indexOf(" ")>-1){var f=filter.substring(filter.indexOf(" ")).replace(/^[ ']*|[ ']*$/g,"");filter_args=f.split(/(?:[\'"])[ ]?,[ ]?(?:[\'"])/);filter=filter.substring(0,filter.indexOf(" "))}val=renderer.filters[filter](val,filter_args)}}if(val!==undefined)return val}catch(err){}return""})},_replaceObjects:function(renderer,_tempo,i,str){var regex=new RegExp("(?:__[\\.]?)((_tempo|\\[|"+utils.memberRegex(i)+"|this)([A-Za-z0-9$\\._\\[\\]]+)?)","g");return str.replace(regex,function(match,variable,args){try{var val=null;if(utils.startsWith(variable,"_tempo."))return eval(variable);variable==="this"||variable.match(/this[\\[\\.]/)!==null?val=eval("i"+variable.substring(4,variable.length)):utils.typeOf(i)==="array"?val=eval("i"+variable):val=eval("i."+variable);if(val!==undefined)return utils.typeOf(val)==="string"?"'"+val+"'":val}catch(err){}return undefined})},_applyAttributeSetters:function(e,t,n){return n.replace(/([A-z0-9]+?)(?:="[^"']*?"[^>]*?)data-\1="(.*?)"/g,function(e,t,n){return n!==""?t+'="'+n+'"':e})},_applyTags:function(e,t,n){return n.replace(this.tagRegex,function(n,r,i,s){if(e.tags.hasOwnProperty(r)){i=i.substring(i.indexOf(" ")).replace(/^[ ]*|[ ]*$/g,"");var o=i.split(/(?:['"])[ ]?,[ ]?(?:['"])/);return e.tags[r](e,t,n,o,s)}return""})},starting:function(){this.started=!0;utils.notify(this.listener,new TempoEvent(TempoEvent.Types.RENDER_STARTING,undefined,undefined));return this},renderItem:function(renderer,tempo_info,i,fragment){var template=renderer.templates.templateFor(i);renderer.templates.nestedItem!==null&&utils.hasAttr(template,"data-template")&&utils.removeAttr(template,"data-template");if(template&&i){utils.notify(this.listener,new TempoEvent(TempoEvent.Types.ITEM_RENDER_STARTING,i,template));var nestedDeclaration=template.innerHTML.match(/data-template="(.*?)"/g);if(nestedDeclaration)for(var p=0;p<nestedDeclaration.length;p++){var nested=nestedDeclaration[p].match(/"(.*?)"/)[1],t=new Templates(renderer.templates.params,nested);t.parse(template);var r=new Renderer(t);r.render(eval("i."+nested))}var html=template.innerHTML.replace(/%7B%7B/g,"{{").replace(/%7D%7D/g,"}}");html=this._applyTags(this,i,html);html=this._replaceVariables(this,tempo_info,i,html);html=this._replaceObjects(this,tempo_info,i,html);for(var a=0;a<template.attributes.length;a++){var attr=template.attributes[a];attr.specified===!0&&template.setAttribute(attr.name,this._replaceVariables(this,tempo_info,i,attr.value))}html=this._applyAttributeSetters(this,i,html);fragment.appendChild(utils.getElement(template,html));utils.notify(this.listener,new TempoEvent(TempoEvent.Types.ITEM_RENDER_COMPLETE,i,template))}},_createFragment:function(e){if(e){var t={},n=document.createDocumentFragment();utils.typeOf(e)==="object"&&(e=[e]);for(var r=0;r<e.length;r++){t.index=r;this.renderItem(this,t,e[r],n)}return n}return null},render:function(e){this.started||utils.notify(this.listener,new TempoEvent(TempoEvent.Types.RENDER_STARTING,undefined,undefined));this.clear();this.append(e);return this},append:function(e){this.started||utils.notify(this.listener,new TempoEvent(TempoEvent.Types.RENDER_STARTING,undefined,undefined));if(e!==undefined){var t=this._createFragment(e);t!==null&&this.templates.container.appendChild(t)}utils.notify(this.listener,new TempoEvent(TempoEvent.Types.RENDER_COMPLETE,undefined,undefined));return this},prepend:function(e){this.started||utils.notify(this.listener,new TempoEvent(TempoEvent.Types.RENDER_STARTING,undefined,undefined));var t=this._createFragment(e);t!==null&&this.templates.container.insertBefore(t,this.templates.container.firstChild);utils.notify(this.listener,new TempoEvent(TempoEvent.Types.RENDER_COMPLETE,undefined,undefined));return this},clear:function(e){utils.clearContainer(this.templates.container)},tags:{"if":function(renderer,i,match,args,body){var member_regex=utils.memberRegex(i),expr=args[0].replace(/&amp;/g,"&");expr=expr.replace(new RegExp(member_regex,"gi"),function(e){return"i."+e});var blockRegex=new RegExp(renderer.templates.tag_brace_left+"[ ]?else[ ]?"+renderer.templates.tag_brace_right,"g"),blocks=body.split(blockRegex);return eval(expr)?blocks[0]:blocks.length>1?blocks[1]:""}},filters:{truncate:function(e,t){if(e!==undefined){var n=0,r="...";t.length>0&&(n=parseInt(t[0],10));t.length>1&&(r=t[1]);return e.length>n-3?e.substr(0,n-3)+r:e}},format:function(e,t){if(e!==undefined){var n=(e+"").split("."),r=n[0],i=n.length>1?"."+n[1]:"";while(NUMBER_FORMAT_REGEX.test(r))r=r.replace(NUMBER_FORMAT_REGEX,"$1,$2");return r+i}},upper:function(e,t){return e.toUpperCase()},lower:function(e,t){return e.toLowerCase()},trim:function(e,t){return utils.trim(e)},replace:function(e,t){return e!==undefined&&t.length===2?e.replace(new RegExp(t[0],"g"),t[1]):e},append:function(e,t){return e!==undefined&&t.length===1?e+""+t[0]:e},prepend:function(e,t){return e!==undefined&&t.length===1?t[0]+""+e:e},join:function(e,t){return t.length===1&&e!==undefined&&utils.typeOf(e)==="array"?e.join(t[0]):e},"default":function(e,t){return e!==undefined&&e!==null?e:t.length===1?t[0]:e},date:function(e,t){if(e!==undefined&&t.length===1){var n=new Date(e),r=t[0];if(r==="localedate")return n.toLocaleDateString();if(r==="localetime")return n.toLocaleTimeString();if(r==="date")return n.toDateString();if(r==="time")return n.toTimeString();var i=["January","February","March","April","May","June","July","August","September","October","November","December"],s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o={YYYY:function(e){return e.getFullYear()},YY:function(e){return e.getFullYear().toFixed().substring(2)},MMMM:function(e){return i[e.getMonth()]},MMM:function(e){return i[e.getMonth()].substring(0,3)},MM:function(e){return utils.pad((e.getMonth()+1).toFixed(),"0",2)},M:function(e){return e.getMonth()+1},DD:function(e){return utils.pad(e.getDate().toFixed(),"0",2)},D:function(e){return e.getDate()},EEEE:function(e){return s[e.getDay()]},EEE:function(e){return s[e.getDay()].substring(0,3)},E:function(e){return e.getDay()},HH:function(e){return utils.pad(e.getHours().toFixed(),"0",2)},H:function(e){return e.getHours()},h:function(e){var t=e.getHours();return t<13?t===0?12:t:t-12},mm:function(e){return utils.pad(e.getMinutes().toFixed(),"0",2)},m:function(e){return e.getMinutes()},ss:function(e){return utils.pad(e.getSeconds().toFixed(),"0",2)},s:function(e){return e.getSeconds()},SSS:function(e){return utils.pad(e.getMilliseconds().toFixed(),"0",3)},S:function(e){return e.getMilliseconds()},a:function(e){return e.getHours()<12?"AM":"PM"}};r=r.replace(/(\\)?(Y{2,4}|M{1,4}|D{1,2}|E{1,4}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|a)/g,function(e,t,r){return!t&&o.hasOwnProperty(r)?o[r](n):r});return r}return""}}};tempo.prepare=function(e,t){typeof e=="string"&&(e=document.getElementById(e));var n=new Templates(t);n.parse(e);return new Renderer(n)};tempo.test={utils:utils,templates:new Templates({}),renderer:new Renderer(new Templates({}))};return tempo}(Tempo||{});